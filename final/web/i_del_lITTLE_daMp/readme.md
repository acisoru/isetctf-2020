# i_del_lITTLE_daMp

## Условие

> **Записки охранника Игоря:** _день второй_
>
> Сисадмин-новичок арендовал себе VPS, хочет стать try linux пользователем. За завтраком пожелал ему удачи. До обеда он пытался открыть консоль, чтобы с корпоративного сервера зайти на свой VPS, но какая-то [система](http://ваш_сайт:5656) под названием **lITTLE daMp** не дает ничего сделать. Говорят, эта система хранит учётные данные всех сотрудников нашего банка, также можно в ней можно настроить доступ для каждого. Для этого всего-то надо знать маленький **секретик** в чьём-то этой системы.
>
> Собрал логины и пароли товарищей, **Павлика** среди них нет,но вдруг чем-то поможет..

```
susmith5:susmith5
jsmith1:jsmith1
sbrown20:sbrown20
```

> P.S. Секретик обернуть во `flag{}`

## Решение

`Little damp` -- Немного влажно? Не то. Заметим, что регистр разный. Может быть, конечно, это просто так, но все-таки лучше проверить.

`lITTLE daMp`? -- Заглавные буквы ничего не дают, попробуем инверсировать:

`Little DAmP` -- `LDAP`? Больше похоже на правду. Гуглим.

`LDAP` означает `Lightweight Directory Access Protocol`. Это сетевой протокол прикладного уровня для доступа к так называемой службе каталогов.

К этому выводу можно было прийти и логически. Службы каталогов хранят и передают важную конфиденциальную информацию, связанную с пользователями, паролями и учетными записями.

Если вкратце, то `LDAP` сервер содержит базу данных, где данные хранятся в виде `“атрибут = значение”`. `LDAP` описывает как эти данные могут быть получены и изменены. `LDAP` подразумевает готовые схемы хранения данных для совершенно разных случаев. Учётные записи? Пожалуйста. Справочник адресов? Пожалуйста. Права и привилегии? Разумеется.

Если есть авторизация на основе `LDAP`, логично предположить, что это можно как-то сломать. После небольшого поиска в интернете находим название возможной уязвимости -- некая `LDAP`-инъекция.

Наше бедное приложение спрашивает у пользователя его имя и пароль, которые пользователь услужливо предоставляет. Далее наше милое приложение отправляет `LDAP`-запрос к нашему `LDAP`-хранилищу, чтобы получить соответствующую запись о нашем пользователе. Если такая запись была найдена, то счастливый пользователь получает доступ, который ознаменовывается появлением доступной информации:имя,mail,телефон и описание(о себе).

Так как фильтрации входных данных, настроенной на сервере, не хватает, мы можем влиять на отправляемую строку.

Сервер возвращает разные ответы в зависимости от результатов обработки запроса `LDAP`.На данный момент у нас на руках `LDAP`-инъекция с фильтрацией на `%00`.

После попытки залогиниться под учётными данными, так кстати собранными охранником Игорем, видим, что не вся информация показывается в профиле: `e-Mail: [try_harder]@ctf.ru`

Из описания можно заключить, что нам нужна секретная корпоративная почта, да не кого-то там, а именно `Павлика`. По стандарту предположим, что он сидит под `admin`.

Ваши сканеры могут также найти креды `user:user`, но, очевидно, это не приблизит Вас к решению, но более внимательные могут заметить в конце описания `Are you sure an admin?`, что лишний раз подтверждает необходимость взломать именно админа.

Разберемся в логике запроса. Самый банальный:

```
(&
    (login=$login)
    (password=$pass)
)
```

Если добавить проверку на поле `mail`, получится следующий payload:

login=`admin)(|(mail=*`

password=`1337)`

В итоге запрос имеет вид:

```
(&
    (login=admin)
    (|
        (mail=*)
        (password=1337)
    )
)
```

`Blind LDAP injections`
Теперь перед `*` в поле `mail` можно перебирать значения, пока не получим флаг.

Реализацию данной атаки можно посмотреть в файле `hack.py`.<br/>
**Флаг:**

> flag{aw350m3ld4pinj3c7i0n}
