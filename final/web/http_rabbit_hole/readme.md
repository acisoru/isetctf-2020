## http_rabbit_hole

> **Записки охранника Игоря:** _день третий и заключительный_
>
> В Warface поиграть не удалось, зато посмотрел интересный [мультик](https://www.youtube.com/watch?v=MmVLuKcmrY0), теперь боюсь кроликов..но они преследуют меня [везде](http://lib.ru/CARROLL/alisa_star.txt).
>
> Скинул сисадмину в телеграмме довольно-таки легкое второе задание по курсам повышения квалификации(**если Вы помните**).
>
> Он никак не может понять, что же там надо делать, не помнит, что сам покупал мне **пачку сигарет**.
>
> На самом деле [задание](http://ваш_сайт:7777) дал мне **САМ Павлик**, но сказал, что стандартными способами решить не получится, но я случайно увидел, что он прячет всю очень важную информацию в `secret`, может быть в этом суть таска?

## Решение

Слишком много разных, не связанных между собой, записок. Enumeration? Необычно. Надо просто найти подходящий вектор? Похоже на правду. Окей, собираем информацию.

Все описание явно **кричит** нам про то, что мы находимся в **RABBIT HOLE** -- такой [сленг](https://otvet.mail.ru/question/25591763), означающий, что мы копаем не в том направлении. Мы еще не начинали копать, но уже не туда. Может быть это уцуцуга? Но описание говорит обратное. Тогда что ? Может, просто нестандартное?

Похоже надо вспомнить, что же было в 3ем таске отборочного этапа.. и **ЗА ЧТО** дал сисадмин Игорю **пачку сигарет**..

> Сетевые утилиты кое-как освоил, помог тот самый охранник **Игорь** , за пачку сигарет согласившись показать мне пару приемов работы с консолью.

Намёк на то, что таск решается через консоль.

> прячет всю очень важную информацию в `secret`

?? Что? Как найти этот секрет?

На сайте ничего интересного не находим, из кода страницы понимаем, что форма авторизации ни к чему не привязана, значит, это мем от автора. Ищем дальше.

Если пробрутить директории, можно найти `/secret`(можно сразу `/secret/`), к этому же можно было прийти, еще раз внимательно прочитав описание.

Но если зайти, получим `403 Forbidden You don't have permission to access /secret on this server.`

Вспоминаем про консоль, делаем запрос: `curl -X GET "http://185.205.210.114:7777/secret"`, а в ответ тишина..Та же ошибка.

Вспоминаем про намеки, что таск решается нестандартно, при этом в консоли, при этом само название дает небольшой хинт: `http_что-то_там`.

Хорошо, если найдем этот [документ](https://www.ptsecurity.com/upload/corporate/ru-ru/webinars/ics/%D0%AE.%D0%93%D0%BE%D0%BB%D1%8C%D1%86%D0%B5%D0%B2_%D0%A3%D1%8F%D0%B7%D0%B2%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8_web_%D1%81%D0%BB%D0%BE%D0%B6%D0%BD%D1%8B%D0%B5_%D1%81%D0%BB%D1%83%D1%87%D0%B0%D0%B8.pdf) или [это](http://turbochaos.blogspot.com/2013/05/htaccess-tricks-verb-tampering.html).

Если нет, ничего страшного, в интернете полно источников про уязвимость `HTTP Verb Tampering`.

`Уязвимость HTTP Verb Tampering` – ошибка настройки контроля доступа для методов протокола HTTP.

- Ошибка администрирования
- Частный случай – ошибка вендора

Многие механизмы аутентификации веб-сервера используют `HTTP Verb` и управления доступом. Такие механизмы безопасности включают в себя правила управления доступом для запросов с конкретными методами `HTTP`, а так же стандартными, такими как `GET` и `POST`. Однако веб-сервер реагирует и на альтернативные методы, которые не предвидел разработчик или даже на произвольные строки символов.

**Пример методов:**

- `OPTIONS`
- `GET`
- `HEAD`
- `POST`
- `PUT`
- `DELETE`
- `TRACE`
- `CONNECT`

Атаки происходят из-за ограничения ресурсов на основе белого или черного списка методов `http`. Методы, не указанные в этом ограниченном списке, могут иметь непредвиденные последствия, например, позволить злоумышленнику обойти требование аутентификации. Давайте посмотрим на образец файла `.htaccess`, в котором используется проблемная директива `LIMIT`:

```
<Limit GET POST PUT>
order deny,allow
deny from all
allow from 127.0.0.1
</Limit>
```

Предполагаемая идея автора заключалась в том, чтобы лимитировать размещение контента на ограниченных ресурсах. К сожалению для разработчика, именно так это и работает. Это ограничивает только `HTTP`-методы `GET`, `POST`, `PUT`, любые другие `HTTP`-методы будут обходить это требование аутентификации.

В этом случае мы можем создать наш собственный `HTTP-метод` и использовать его для получения контента, минуя любые ограничения. Инструмент `HTExploit`(скрипт Python, который использует уязвимость в способе настройки файлов `.htaccess` для защиты веб-каталога с помощью процесса аутентификации.) использует `POTATO`, в то время как в статье 2004 года используется `BILBOA`.

Выполняем запрос `curl -X POTATO "http://185.205.210.114:7777/secret"`, получаем перенаправление:

`The document has moved http://185.205.210.114:7777/secret/`, окей, дальше

`curl -X POTATO "http://185.205.210.114:7777/secret/"` и бинго! В теле ответа получаем флаг:

`where is the [flag{wh47_15_4_H77P_v3r8_74mP3R1n9}]?`

**Флаг:**

> flag{wh47_15_4_H77P_v3r8_74mP3R1n9}
